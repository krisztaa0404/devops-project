FROM grafana/grafana:latest

# Switch to root to copy files and set permissions
USER root

# Copy the provisioning configuration
COPY modules/grafana/provisioning /etc/grafana/provisioning

# Copy the dashboards
COPY modules/grafana/dashboards /etc/grafana/dashboards

# Set proper ownership and permissions
RUN chown -R grafana:root /etc/grafana/provisioning && \
    chown -R grafana:root /etc/grafana/dashboards && \
    find /etc/grafana/provisioning -type d -exec chmod 755 {} \; && \
    find /etc/grafana/provisioning -type f -exec chmod 644 {} \; && \
    find /etc/grafana/dashboards -type d -exec chmod 755 {} \; && \
    find /etc/grafana/dashboards -type f -exec chmod 644 {} \;

# Switch back to grafana user
USER grafana